---
import { type CollectionEntry, getCollection } from 'astro:content';
import MainLayout from '../../layouts/MainLayout.astro';
import Markdown from '../../components/Markdown.astro';
import { formatDateToYYYYMMDD } from '../../utils/date-utils';

export async function getStaticPaths() {
	const posts = await getCollection('posts', ({ data }) => {
		return import.meta.env.PROD ? data.draft !== true : true;
	});
	return posts.map((post) => ({
		params: { slug: post.slug },
		props: post,
	}));
}
type Props = CollectionEntry<'posts'>;

const post = Astro.props;
const { Content } = await post.render();
---

<MainLayout title={post.data.title} description={post.data.description}>
	<div data-pagefind-body data-pagefind-weight="10" data-pagefind-meta="title" class="title">{post.data.title}</div>
	<div class="text-gray-400 flex gap-4 pb-4">
		<span>发布于 {formatDateToYYYYMMDD(post.data.date)}</span>
		{ post.data.tags?.map(tag => <a href={`/tags/${tag}`} class="link">#{tag}</a>) }
	</div>
	<div data-pagefind-body>
		<Markdown>
			<Content/>
		</Markdown>
	</div>
	<!-- <hr class="line" />
	<div class="pb-8">
		作品采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" target="_blank" class="link">《知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议》</a>进行许可
	</div> -->
</MainLayout>

<script>

function loadButtonScript() {
	document.getElementById('btn')?.addEventListener('click', () => {
		window.scrollTo({ top: 0, behavior: 'smooth'})
	})
}

function init() {
	loadButtonScript()
}

init();

document.addEventListener('astro:after-swap', init);

</script>

<style>
	.title {
		@apply text-2xl pb-2 font-bold;
	}

	.line {
		border-color: #2e405b52;
		margin: 1.5rem 0;
	}
</style>
