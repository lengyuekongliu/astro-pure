<article class="prose prose-base max-w-none custom-md">
    <slot/>
</article >

<script>
const observer = new MutationObserver(addPreCopyButton);
observer.observe(document.body, { childList: true, subtree: true });

document.addEventListener("DOMContentLoaded", addPreCopyButton);

function addPreCopyButton() {
    observer.disconnect();

    document.querySelectorAll('pre').forEach(ele => {
        const wrapper = document.createElement('div');
        wrapper.className = 'relative'
        ele.parentNode?.insertBefore(wrapper, ele)

        
        const copyBtn = document.createElement('button')
        copyBtn.type = 'button'
        copyBtn.className = 'absolute right-2 top-2 bg-gray-600 p-1.5 rounded text-gray-200 transition-all duration-300'
        copyBtn.innerHTML = '<i class="iconify text-xl block mdi--content-copy" />'

        wrapper.appendChild(ele)
        wrapper.appendChild(copyBtn)

        let timeout: any;
        copyBtn.addEventListener('click', async () => {
            if (timeout) {
                clearTimeout(timeout);
            }
            const text = ele.querySelector('code')?.innerText
            await navigator.clipboard.writeText(text || '');
            copyBtn.children[0].classList.remove('mdi--content-copy')
            copyBtn.children[0].classList.add('mdi--success')
            copyBtn.classList.remove('bg-gray-600')
            copyBtn.classList.add('bg-blue-500')

            timeout = setTimeout(() => {
                copyBtn.children[0].classList.remove('mdi--success')
                copyBtn.children[0].classList.add('mdi--content-copy')
                copyBtn.classList.remove('bg-blue-500')
                copyBtn.classList.add('bg-gray-600')
            }, 1000)
        })
    })

    
    observer.observe(document.body, { childList: true, subtree: true });
}
</script>

<style lang="less" is:global>
.custom-md {
    
    // kbd {
    //     background-color: white;
    // }

    code {
        counter-reset: line;
        span.line:not(:last-child):before {
            content: counter(line);
            counter-increment: line;
            direction: rtl;
            display: inline-block;
            margin-right: 1rem;
            width: 1rem;
            color: rgba(255, 255, 255, 0.25);
        }
    }
}
</style>